name = "fulfillment-worker"
main = "fulfillmentworker/index.js"
compatibility_date = "2024-09-23"
compatibility_flags = ["nodejs_compat"]

[[d1_databases]]
binding = "fulfillment_db"
database_name = "fulfillment-db"
database_id = "4708b2cc-fa58-4015-ad8e-7b689f652b79"

[[kv_namespaces]]
binding = "SHIPPING_CACHE"
id = "b59ed95bf2a74531b38c7ae95fea67a8"  # Replace with actual KV namespace ID after creation

[[services]]
binding = "auth_worker"
service = "auth-worker"

[[services]]
binding = "log_worker"
service = "log-worker"

[[durable_objects.bindings]]
name = "reserved_stock_do"
class_name = "ReservedStockDO"
script_name = "fulfillment-worker"

# Note: Secrets (like HONEYCOMB_API_KEY) are set via: wrangler secret put HONEYCOMB_API_KEY --config wrangler.fulfillmentworker.toml
# They are not defined in this file.

[vars]
FULFILLMENT_WORKER_URL = "https://fulfillment-worker.shyaamdps.workers.dev"
LOG_WORKER_URL = "https://log-worker.shyaamdps.workers.dev"
AUTH_WORKER_URL = "https://auth-worker.shyaamdps.workers.dev"
INTER_WORKER_API_KEY = "ECOMSECRET"

# Migration to add ReservedStockDO Durable Object class
# Using new_sqlite_classes for free plan compatibility
[[migrations]]
tag = "add-reserved-stock-do-2024"
new_sqlite_classes = ["ReservedStockDO"]

